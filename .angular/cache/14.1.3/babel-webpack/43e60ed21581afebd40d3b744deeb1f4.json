{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"D:/angular/pr1/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLocksByKey = exports.createLocksByKey = exports.getLock = exports.createLock = void 0;\n\nconst queue_1 = require(\"@databases/queue\");\n\nclass FunctionCallTask {\n  constructor(fn, args) {\n    this.fn = fn;\n    this.args = args;\n  }\n\n}\n\nclass QueueRecord {\n  constructor(resolve, task) {\n    this.isTimedOut = false;\n    this.resolve = resolve;\n    this.task = task;\n    this.createdAt = Date.now();\n  }\n\n}\n\nconst lockPool = [];\n\nclass LockImpl {\n  constructor(timeoutMilliseconds, onEmpty, context) {\n    var _this = this;\n\n    this._queue = new queue_1.default();\n    this._active = true;\n    this._executing = false;\n\n    this._onFunctionCallTaskLock = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (task) {\n        try {\n          return yield task.fn(...task.args);\n        } finally {\n          _this.releaseLock();\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n\n    this._onTimeout = () => {\n      this._timeout = undefined;\n\n      const record = this._queue.shift();\n\n      if (record) {\n        record.isTimedOut = true;\n        record.resolve(record);\n      }\n    };\n\n    this._runDelayed = d => {\n      if (this._timeout) {\n        clearTimeout(this._timeout);\n        this._timeout = undefined;\n      }\n\n      const nextRecord = this._queue.peek();\n\n      if (nextRecord && this._timeoutMilliseconds !== undefined) {\n        this._timeout = setTimeout(this._onTimeout, this._timeoutMilliseconds + nextRecord.createdAt - Date.now());\n      }\n\n      if (d.isTimedOut) {\n        this.releaseLock();\n        throw new Error(`Timed out waiting for lock after ${this._timeoutMilliseconds}ms`);\n      }\n\n      return d.task;\n    };\n\n    this._timeoutMilliseconds = timeoutMilliseconds === Infinity ? undefined : timeoutMilliseconds;\n    this._onEmpty = onEmpty;\n    this._context = context;\n  }\n\n  unpool(timeoutMilliseconds, onEmpty, context) {\n    this._timeoutMilliseconds = timeoutMilliseconds === Infinity ? undefined : timeoutMilliseconds;\n    this._onEmpty = onEmpty;\n    this._context = context;\n    this._active = true;\n    return this;\n  }\n\n  pool() {\n    var _this2 = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this2.acquireLock();\n\n      if (_this2._queue.getLength() !== 0) {\n        throw new Error('Cannot pool the lock if it has tasks in the queue.');\n      }\n\n      _this2._onEmpty = undefined;\n      _this2._context = undefined;\n      _this2._active = false;\n      _this2._executing = false;\n      lockPool.push(_this2);\n    })();\n  }\n\n  acquireLock(task) {\n    var _this3 = this;\n\n    return _asyncToGenerator(function* () {\n      if (!_this3._active) {\n        throw new Error('Cannot call Lock after returning the object to the pool.');\n      }\n\n      if (_this3._executing) {\n        if (_this3._timeout === undefined && _this3._timeoutMilliseconds !== undefined) {\n          _this3._timeout = setTimeout(_this3._onTimeout, _this3._timeoutMilliseconds);\n        }\n\n        return new Promise(resolve => {\n          _this3._queue.push(new QueueRecord(resolve, task));\n        }).then(_this3._runDelayed);\n      } else {\n        _this3._executing = true;\n        return task;\n      }\n    })();\n  }\n\n  releaseLock() {\n    const next = this._queue.shift();\n\n    if (next) {\n      next.resolve(next);\n    } else {\n      this._executing = false;\n      if (this._onEmpty) this._onEmpty(this, this._context);\n    }\n  }\n\n  withLock(fn, ...args) {\n    var _this4 = this;\n\n    return _asyncToGenerator(function* () {\n      return yield _this4.acquireLock(new FunctionCallTask(fn, args)).then(_this4._onFunctionCallTaskLock);\n    })();\n  }\n\n}\n\nfunction createLock(timeoutMilliseconds) {\n  if (lockPool.length) {\n    const record = lockPool.pop();\n    return record.unpool(timeoutMilliseconds, undefined, undefined);\n  } else {\n    return new LockImpl(timeoutMilliseconds, undefined, undefined);\n  }\n}\n\nexports.createLock = createLock;\n/**\n * @deprecated use createLock\n */\n\nexports.getLock = createLock;\n\nfunction createLockForKey(timeoutMilliseconds, onEmpty, key) {\n  if (lockPool.length) {\n    const record = lockPool.pop();\n    return record.unpool(timeoutMilliseconds, onEmpty, key);\n  } else {\n    return new LockImpl(timeoutMilliseconds, onEmpty, key);\n  }\n}\n\nclass LocksByKeyImpl {\n  constructor(options) {\n    var _a;\n\n    this._onEmpty = (lock, key) => {\n      this._store.delete(key);\n\n      void lock.pool();\n    };\n\n    this._store = (_a = options.store) !== null && _a !== void 0 ? _a : new Map();\n    this._timeoutMilliseconds = options.timeoutMilliseconds;\n  }\n\n  acquireLock(key, task) {\n    var _this5 = this;\n\n    return _asyncToGenerator(function* () {\n      const existingLock = _this5._store.get(key);\n\n      if (existingLock) {\n        return yield existingLock.acquireLock(task);\n      }\n\n      const newLock = createLockForKey(_this5._timeoutMilliseconds, _this5._onEmpty, key);\n\n      _this5._store.set(key, newLock);\n\n      return yield newLock.acquireLock(task);\n    })();\n  }\n\n  withLock(key, fn, ...args) {\n    var _this6 = this;\n\n    return _asyncToGenerator(function* () {\n      const existingLock = _this6._store.get(key);\n\n      if (existingLock) {\n        return yield existingLock.withLock(fn, ...args);\n      }\n\n      const newLock = createLockForKey(_this6._timeoutMilliseconds, _this6._onEmpty, key);\n\n      _this6._store.set(key, newLock);\n\n      return yield newLock.withLock(fn, ...args);\n    })();\n  }\n\n  releaseLock(key) {\n    const existingLock = this._store.get(key);\n\n    if (existingLock) {\n      existingLock.releaseLock();\n    }\n  }\n\n}\n\nfunction createLocksByKey(options = {}) {\n  return new LocksByKeyImpl(options);\n}\n\nexports.createLocksByKey = createLocksByKey;\n/**\n * @deprecated use createLocksByKey\n */\n\nexports.getLocksByKey = createLocksByKey;","map":{"version":3,"names":["Object","defineProperty","exports","value","getLocksByKey","createLocksByKey","getLock","createLock","queue_1","require","FunctionCallTask","constructor","fn","args","QueueRecord","resolve","task","isTimedOut","createdAt","Date","now","lockPool","LockImpl","timeoutMilliseconds","onEmpty","context","_queue","default","_active","_executing","_onFunctionCallTaskLock","releaseLock","_onTimeout","_timeout","undefined","record","shift","_runDelayed","d","clearTimeout","nextRecord","peek","_timeoutMilliseconds","setTimeout","Error","Infinity","_onEmpty","_context","unpool","pool","acquireLock","getLength","push","Promise","then","next","withLock","length","pop","createLockForKey","key","LocksByKeyImpl","options","_a","lock","_store","delete","store","Map","existingLock","get","newLock","set"],"sources":["D:/angular/pr1/node_modules/@databases/lock/lib/index.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getLocksByKey = exports.createLocksByKey = exports.getLock = exports.createLock = void 0;\nconst queue_1 = require(\"@databases/queue\");\nclass FunctionCallTask {\n    constructor(fn, args) {\n        this.fn = fn;\n        this.args = args;\n    }\n}\nclass QueueRecord {\n    constructor(resolve, task) {\n        this.isTimedOut = false;\n        this.resolve = resolve;\n        this.task = task;\n        this.createdAt = Date.now();\n    }\n}\nconst lockPool = [];\nclass LockImpl {\n    constructor(timeoutMilliseconds, onEmpty, context) {\n        this._queue = new queue_1.default();\n        this._active = true;\n        this._executing = false;\n        this._onFunctionCallTaskLock = async (task) => {\n            try {\n                return await task.fn(...task.args);\n            }\n            finally {\n                this.releaseLock();\n            }\n        };\n        this._onTimeout = () => {\n            this._timeout = undefined;\n            const record = this._queue.shift();\n            if (record) {\n                record.isTimedOut = true;\n                record.resolve(record);\n            }\n        };\n        this._runDelayed = (d) => {\n            if (this._timeout) {\n                clearTimeout(this._timeout);\n                this._timeout = undefined;\n            }\n            const nextRecord = this._queue.peek();\n            if (nextRecord && this._timeoutMilliseconds !== undefined) {\n                this._timeout = setTimeout(this._onTimeout, this._timeoutMilliseconds + nextRecord.createdAt - Date.now());\n            }\n            if (d.isTimedOut) {\n                this.releaseLock();\n                throw new Error(`Timed out waiting for lock after ${this._timeoutMilliseconds}ms`);\n            }\n            return d.task;\n        };\n        this._timeoutMilliseconds =\n            timeoutMilliseconds === Infinity ? undefined : timeoutMilliseconds;\n        this._onEmpty = onEmpty;\n        this._context = context;\n    }\n    unpool(timeoutMilliseconds, onEmpty, context) {\n        this._timeoutMilliseconds =\n            timeoutMilliseconds === Infinity ? undefined : timeoutMilliseconds;\n        this._onEmpty = onEmpty;\n        this._context = context;\n        this._active = true;\n        return this;\n    }\n    async pool() {\n        await this.acquireLock();\n        if (this._queue.getLength() !== 0) {\n            throw new Error('Cannot pool the lock if it has tasks in the queue.');\n        }\n        this._onEmpty = undefined;\n        this._context = undefined;\n        this._active = false;\n        this._executing = false;\n        lockPool.push(this);\n    }\n    async acquireLock(task) {\n        if (!this._active) {\n            throw new Error('Cannot call Lock after returning the object to the pool.');\n        }\n        if (this._executing) {\n            if (this._timeout === undefined &&\n                this._timeoutMilliseconds !== undefined) {\n                this._timeout = setTimeout(this._onTimeout, this._timeoutMilliseconds);\n            }\n            return new Promise((resolve) => {\n                this._queue.push(new QueueRecord(resolve, task));\n            }).then(this._runDelayed);\n        }\n        else {\n            this._executing = true;\n            return task;\n        }\n    }\n    releaseLock() {\n        const next = this._queue.shift();\n        if (next) {\n            next.resolve(next);\n        }\n        else {\n            this._executing = false;\n            if (this._onEmpty)\n                this._onEmpty(this, this._context);\n        }\n    }\n    async withLock(fn, ...args) {\n        return await this.acquireLock(new FunctionCallTask(fn, args)).then(this._onFunctionCallTaskLock);\n    }\n}\nfunction createLock(timeoutMilliseconds) {\n    if (lockPool.length) {\n        const record = lockPool.pop();\n        return record.unpool(timeoutMilliseconds, undefined, undefined);\n    }\n    else {\n        return new LockImpl(timeoutMilliseconds, undefined, undefined);\n    }\n}\nexports.createLock = createLock;\n/**\n * @deprecated use createLock\n */\nexports.getLock = createLock;\nfunction createLockForKey(timeoutMilliseconds, onEmpty, key) {\n    if (lockPool.length) {\n        const record = lockPool.pop();\n        return record.unpool(timeoutMilliseconds, onEmpty, key);\n    }\n    else {\n        return new LockImpl(timeoutMilliseconds, onEmpty, key);\n    }\n}\nclass LocksByKeyImpl {\n    constructor(options) {\n        var _a;\n        this._onEmpty = (lock, key) => {\n            this._store.delete(key);\n            void lock.pool();\n        };\n        this._store = (_a = options.store) !== null && _a !== void 0 ? _a : new Map();\n        this._timeoutMilliseconds = options.timeoutMilliseconds;\n    }\n    async acquireLock(key, task) {\n        const existingLock = this._store.get(key);\n        if (existingLock) {\n            return await existingLock.acquireLock(task);\n        }\n        const newLock = createLockForKey(this._timeoutMilliseconds, this._onEmpty, key);\n        this._store.set(key, newLock);\n        return await newLock.acquireLock(task);\n    }\n    async withLock(key, fn, ...args) {\n        const existingLock = this._store.get(key);\n        if (existingLock) {\n            return await existingLock.withLock(fn, ...args);\n        }\n        const newLock = createLockForKey(this._timeoutMilliseconds, this._onEmpty, key);\n        this._store.set(key, newLock);\n        return await newLock.withLock(fn, ...args);\n    }\n    releaseLock(key) {\n        const existingLock = this._store.get(key);\n        if (existingLock) {\n            existingLock.releaseLock();\n        }\n    }\n}\nfunction createLocksByKey(options = {}) {\n    return new LocksByKeyImpl(options);\n}\nexports.createLocksByKey = createLocksByKey;\n/**\n * @deprecated use createLocksByKey\n */\nexports.getLocksByKey = createLocksByKey;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}