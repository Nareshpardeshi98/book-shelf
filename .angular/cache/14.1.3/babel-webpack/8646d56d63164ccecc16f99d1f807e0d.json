{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"D:/angular/pr1/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst queue_1 = require(\"@databases/queue\");\n\nfunction pushToAsyncIterable(getStream) {\n  const queue = new queue_1.AsyncQueue();\n  let bufferSize = 0;\n  let paused = false;\n  let ended = false;\n  const stream = getStream({\n    onData(value) {\n      if (!ended) {\n        queue.push({\n          done: false,\n          value\n        });\n        bufferSize++;\n\n        if (!paused && bufferSize >= stream.highWaterMark) {\n          paused = true;\n          stream.pause();\n        }\n      }\n    },\n\n    onError(err) {\n      if (!ended) {\n        ended = true;\n        queue.push({\n          done: true,\n          err\n        });\n      }\n    },\n\n    onEnd() {\n      if (!ended) {\n        ended = true;\n        queue.push({\n          done: true,\n          err: undefined\n        });\n      }\n    }\n\n  });\n  return {\n    next() {\n      return _asyncToGenerator(function* () {\n        bufferSize--;\n\n        if (paused && bufferSize < stream.highWaterMark) {\n          paused = false;\n          stream.resume();\n        }\n\n        const next = yield queue.shift();\n\n        if (next.done && next.err) {\n          throw next.err;\n        } else if (next.done) {\n          return {\n            done: true,\n            value: undefined\n          };\n        } else {\n          return next;\n        }\n      })();\n    },\n\n    return() {\n      return _asyncToGenerator(function* () {\n        stream.dispose();\n        return {\n          done: true,\n          value: undefined\n        };\n      })();\n    },\n\n    throw(e) {\n      return _asyncToGenerator(function* () {\n        stream.dispose();\n        throw e;\n      })();\n    },\n\n    [Symbol.asyncIterator]() {\n      // tslint:disable-next-line no-invalid-this\n      return this;\n    }\n\n  };\n}\n\nexports.default = pushToAsyncIterable;","map":{"version":3,"names":["Object","defineProperty","exports","value","queue_1","require","pushToAsyncIterable","getStream","queue","AsyncQueue","bufferSize","paused","ended","stream","onData","push","done","highWaterMark","pause","onError","err","onEnd","undefined","next","resume","shift","return","dispose","throw","e","Symbol","asyncIterator","default"],"sources":["D:/angular/pr1/node_modules/@databases/push-to-async-iterable/lib/index.js"],"sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nconst queue_1 = require(\"@databases/queue\");\n\nfunction pushToAsyncIterable(getStream) {\n  const queue = new queue_1.AsyncQueue();\n  let bufferSize = 0;\n  let paused = false;\n  let ended = false;\n  const stream = getStream({\n    onData(value) {\n      if (!ended) {\n        queue.push({\n          done: false,\n          value\n        });\n        bufferSize++;\n\n        if (!paused && bufferSize >= stream.highWaterMark) {\n          paused = true;\n          stream.pause();\n        }\n      }\n    },\n\n    onError(err) {\n      if (!ended) {\n        ended = true;\n        queue.push({\n          done: true,\n          err\n        });\n      }\n    },\n\n    onEnd() {\n      if (!ended) {\n        ended = true;\n        queue.push({\n          done: true,\n          err: undefined\n        });\n      }\n    }\n\n  });\n  return {\n    async next() {\n      bufferSize--;\n\n      if (paused && bufferSize < stream.highWaterMark) {\n        paused = false;\n        stream.resume();\n      }\n\n      const next = await queue.shift();\n\n      if (next.done && next.err) {\n        throw next.err;\n      } else if (next.done) {\n        return {\n          done: true,\n          value: undefined\n        };\n      } else {\n        return next;\n      }\n    },\n\n    async return() {\n      stream.dispose();\n      return {\n        done: true,\n        value: undefined\n      };\n    },\n\n    async throw(e) {\n      stream.dispose();\n      throw e;\n    },\n\n    [Symbol.asyncIterator]() {\n      // tslint:disable-next-line no-invalid-this\n      return this;\n    }\n\n  };\n}\n\nexports.default = pushToAsyncIterable;"],"mappings":"AAAA;;;;AAEAA,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAC3CC,KAAK,EAAE;AADoC,CAA7C;;AAIA,MAAMC,OAAO,GAAGC,OAAO,CAAC,kBAAD,CAAvB;;AAEA,SAASC,mBAAT,CAA6BC,SAA7B,EAAwC;EACtC,MAAMC,KAAK,GAAG,IAAIJ,OAAO,CAACK,UAAZ,EAAd;EACA,IAAIC,UAAU,GAAG,CAAjB;EACA,IAAIC,MAAM,GAAG,KAAb;EACA,IAAIC,KAAK,GAAG,KAAZ;EACA,MAAMC,MAAM,GAAGN,SAAS,CAAC;IACvBO,MAAM,CAACX,KAAD,EAAQ;MACZ,IAAI,CAACS,KAAL,EAAY;QACVJ,KAAK,CAACO,IAAN,CAAW;UACTC,IAAI,EAAE,KADG;UAETb;QAFS,CAAX;QAIAO,UAAU;;QAEV,IAAI,CAACC,MAAD,IAAWD,UAAU,IAAIG,MAAM,CAACI,aAApC,EAAmD;UACjDN,MAAM,GAAG,IAAT;UACAE,MAAM,CAACK,KAAP;QACD;MACF;IACF,CAdsB;;IAgBvBC,OAAO,CAACC,GAAD,EAAM;MACX,IAAI,CAACR,KAAL,EAAY;QACVA,KAAK,GAAG,IAAR;QACAJ,KAAK,CAACO,IAAN,CAAW;UACTC,IAAI,EAAE,IADG;UAETI;QAFS,CAAX;MAID;IACF,CAxBsB;;IA0BvBC,KAAK,GAAG;MACN,IAAI,CAACT,KAAL,EAAY;QACVA,KAAK,GAAG,IAAR;QACAJ,KAAK,CAACO,IAAN,CAAW;UACTC,IAAI,EAAE,IADG;UAETI,GAAG,EAAEE;QAFI,CAAX;MAID;IACF;;EAlCsB,CAAD,CAAxB;EAqCA,OAAO;IACCC,IAAN,GAAa;MAAA;QACXb,UAAU;;QAEV,IAAIC,MAAM,IAAID,UAAU,GAAGG,MAAM,CAACI,aAAlC,EAAiD;UAC/CN,MAAM,GAAG,KAAT;UACAE,MAAM,CAACW,MAAP;QACD;;QAED,MAAMD,IAAI,SAASf,KAAK,CAACiB,KAAN,EAAnB;;QAEA,IAAIF,IAAI,CAACP,IAAL,IAAaO,IAAI,CAACH,GAAtB,EAA2B;UACzB,MAAMG,IAAI,CAACH,GAAX;QACD,CAFD,MAEO,IAAIG,IAAI,CAACP,IAAT,EAAe;UACpB,OAAO;YACLA,IAAI,EAAE,IADD;YAELb,KAAK,EAAEmB;UAFF,CAAP;QAID,CALM,MAKA;UACL,OAAOC,IAAP;QACD;MAnBU;IAoBZ,CArBI;;IAuBCG,MAAN,GAAe;MAAA;QACbb,MAAM,CAACc,OAAP;QACA,OAAO;UACLX,IAAI,EAAE,IADD;UAELb,KAAK,EAAEmB;QAFF,CAAP;MAFa;IAMd,CA7BI;;IA+BCM,KAAN,CAAYC,CAAZ,EAAe;MAAA;QACbhB,MAAM,CAACc,OAAP;QACA,MAAME,CAAN;MAFa;IAGd,CAlCI;;IAoCL,CAACC,MAAM,CAACC,aAAR,IAAyB;MACvB;MACA,OAAO,IAAP;IACD;;EAvCI,CAAP;AA0CD;;AAED7B,OAAO,CAAC8B,OAAR,GAAkB1B,mBAAlB"},"metadata":{},"sourceType":"script"}